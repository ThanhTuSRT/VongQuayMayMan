<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>V√≤ng quay may m·∫Øn l·ªõp h·ªçc</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: radial-gradient(circle, #fefefe, #b3e5fc);
      font-family: "Poppins", sans-serif;
      overflow: hidden;
    }
    .wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
    }
    canvas {
      border: 8px solid #0288d1;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    /* M≈©i t√™n hi·ªÉn th·ªã ngay tr√™n v√≤ng quay */
    .pointer {
      position: absolute;
      top: 52%;
      right: -22px; /* nh√¥ ra ngo√†i m·ªôt ch√∫t cho ƒë·∫πp */
      transform: translateY(-50%) rotate(90deg);
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 22px solid #e53935;
      z-index: 10;
    }
    button {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #0288d1;
      color: white;
      transition: 0.3s;
      margin-right: 10px;
    }
    button:hover {
      background: #01579b;
    }
    #controls {
      display: flex;
      justify-content: center;
    }
    #result {
      margin-top: 10px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="400" height="400"></canvas>
  </div>
  <div id="controls">
    <button id="spin">üé° Quay!</button>
    <button id="shuffle">üîÅ X√°o tr·ªôn danh s√°ch</button>
  </div>
  <h2 id="result"></h2>

  <script>
    // üßç Danh s√°ch h·ªçc sinh
    let students = [
      "L√Ω Ng·ªçc Minh An", "Tr·∫ßn L√™ M·ªπ Anh", "Nguy·ªÖn Xu√¢n B√°ch", "Phan Th√°i B√¨nh",
      "L√™ B·∫£o Ch√¢u", "Nguy·ªÖn H·ªì Huy·ªÅn Ch√¢u", "Nguy·ªÖn Th·ªã Ho√†ng Ch√¢u", "Nguy·ªÖn ƒê·ª©c D≈©ng",
      "L√Ω Thanh Duy", "L√¢m ƒê·∫∑ng Kh√°nh ƒêƒÉng", "Nguy·ªÖn Tr·ªçng ƒê·ª©c", "Tr·∫ßn Quang H√†o",
      "ƒê·∫∑ng Ti·∫øn Huy", "L√™ Th·ªã Di·ªÖm Ki·ªÅu", "Hu·ª≥nh B·∫£o Lam", "Nguy·ªÖn Ho√†ng Long",
      "Ph·∫°m Xu√¢n Mai", "Ng√¥ Quang Minh", "Nguy·ªÖn Qu·ªëc Minh", "Tr∆∞∆°ng Tr·∫ßn H√† My",
      "Nguy·ªÖn L√™ Gia M·ªπ", "ƒê·∫∑ng Th·ªã Kim Ng√¢n", "Nguy·ªÖn Thi·ªán Nh√¢n", "L√™ Ng·ªçc Th·∫£o Nh∆∞",
      "Nguy·ªÖn Th·ªã Hu·ª≥nh Nh∆∞", "Nguy·ªÖn VƒÉn Phi", "Nguy·ªÖn Hu·ª≥nh Y·∫øn Ph∆∞∆°ng", "Nguy·ªÖn Th·ªã Tr√∫c Ph∆∞∆°ng",
      "Nguy·ªÖn Nh∆∞ Qu·ª≥nh", "H·ªì ƒê·ªó Mai Thanh", "Nguy·ªÖn Th·ªã Ph∆∞∆°ng Th·∫£o", "Nguy·ªÖn T·ªëng Anh Th∆∞",
      "Cao Hu·ª≥nh Kim Ti·ªÅn", "Ph·∫°m Ph√∫c Ti·∫øn", "ƒê·∫∑ng Thu·ª≥ Tr√¢m", "Nguy·ªÖn B·∫£o Tr·ªçng",
      "Nguy·ªÖn Thanh T√∫", "Nguy·ªÖn H√† Kh√°nh Tu·∫•n", "Nguy·ªÖn Ph·∫°m Tr√∫c Vy", "Tr∆∞∆°ng L√™ T∆∞·ªùng Vy",
      "Chung Tri·ªáu V·ªπ", "Nguy·ªÖn Th·ªã M·ªπ Xuy√™n", "Ph·∫°m Th·ªã Nh∆∞ √ù (2009)", "Ph·∫°m Th·ªã Nh∆∞ √ù (2008)"
    ];

    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const size = canvas.width;
    const radius = size / 2;
    const colors = [
      "#ffb74d","#81c784","#64b5f6","#ba68c8","#e57373","#4db6ac","#f06292","#aed581",
      "#9575cd","#4dd0e1","#dce775","#a1887f","#f48fb1","#7986cb","#ff8a65","#aed581"
    ];

    // üîÄ X√°o tr·ªôn ng·∫´u nhi√™n (Fisher‚ÄìYates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // ‚úÇÔ∏è H√†m l·∫•y 2 ch·ªØ cu·ªëi c√πng c·ªßa t√™n
    function shortName(fullName) {
      const parts = fullName.trim().split(" ");
      return parts.slice(-2).join(" ");
    }

    // üé® V·∫Ω v√≤ng quay
    function drawWheel() {
      ctx.clearRect(0, 0, size, size);
      const arc = 2 * Math.PI / students.length;
      for (let i = 0; i < students.length; i++) {
        ctx.beginPath();
        ctx.fillStyle = colors[i % colors.length];
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius, i * arc, (i + 1) * arc);
        ctx.lineTo(radius, radius);
        ctx.fill();

        // üè∑ V·∫Ω t√™n (ch·ªâ 2 ch·ªØ cu·ªëi)
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(i * arc + arc / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#fff";
        ctx.font = "bold 13px sans-serif";
        ctx.fillText(shortName(students[i]), radius - 10, 5);
        ctx.restore();
      }
    }

    // üîÑ X√°o tr·ªôn ban ƒë·∫ßu khi t·∫£i trang
    shuffleArray(students);
    drawWheel();

    // üåÄ Quay v√≤ng
    let rotation = 0;
    let spinning = false;

    document.getElementById("spin").onclick = () => {
      if (spinning) return;
      spinning = true;
      document.getElementById("result").textContent = "";
      const spinAngle = Math.random() * 360 + 720; // √≠t nh·∫•t 2 v√≤ng
      const duration = 4000;
      const start = performance.now();

      function animate(now) {
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const angle = rotation + spinAngle * easeOut;

        ctx.clearRect(0, 0, size, size);
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate((angle * Math.PI) / 180);
        ctx.translate(-radius, -radius);
        drawWheel();
        ctx.restore();

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          rotation = (rotation + spinAngle) % 360;
          const arc = 360 / students.length;
          const index = Math.floor((students.length - (rotation % 360) / arc) % students.length);
          document.getElementById("result").textContent = "üéâ K·∫øt qu·∫£: " + students[index] + "!";
          spinning = false;
        }
      }
      requestAnimationFrame(animate);
    };

    // üîÅ N√∫t x√°o tr·ªôn
    document.getElementById("shuffle").onclick = () => {
      if (spinning) return;
      shuffleArray(students);
      drawWheel();
      document.getElementById("result").textContent = "üîÄ Danh s√°ch ƒë√£ ƒë∆∞·ª£c x√°o tr·ªôn!";
    };
  </script>
</body>
</html>
